<!doctype html>
<html lang="ro">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MiniRevolut</title>
  <meta name="theme-color" content="#06b6d4">
  <style>
    :root{--bg:#f5f9fb;--card:#fff;--accent:#06b6d4;--muted:#6b7280;--success:#10b981;--danger:#ef4444;font-family:Inter,system-ui,Arial,sans-serif}
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:#0f172a;padding:12px;display:flex;justify-content:center;min-height:100vh}
    .app{width:100%;max-width:980px;background:var(--card);border-radius:14px;padding:14px;box-shadow:0 6px 18px rgba(2,6,23,0.06)}
    header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
    h1{margin:0;font-size:18px}
    .small{font-size:13px;color:var(--muted)}
    .nav{display:flex;gap:8px;margin-top:6px}
    .nav button{padding:8px 12px;border-radius:10px;border:1px solid rgba(15,23,42,0.04);background:transparent;cursor:pointer}
    .nav button.active{background:linear-gradient(180deg,rgba(6,182,212,0.12),rgba(6,182,212,0.08));border-color:rgba(6,182,212,0.25)}
    .card-row{display:flex;gap:12px;overflow:auto;padding:10px 6px;scroll-snap-type:x mandatory}
    .card-item{flex:0 0 260px;scroll-snap-align:start;border-radius:12px;overflow:hidden;cursor:pointer;border:1px solid rgba(0,0,0,0.04);box-shadow:0 6px 14px rgba(2,6,23,0.04)}
    .card-preview{height:140px;padding:12px;color:#fff;display:flex;align-items:flex-end;position:relative;overflow:hidden}
    .card-title{position:absolute;right:12px;bottom:10px;font-weight:700}
    .card-dot{position:absolute;left:12px;top:12px;width:36px;height:36px;border-radius:50%;background:rgba(255,255,255,0.15)}
    .cards-controls{display:flex;gap:8px;align-items:center;margin-top:10px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:12px}
    .panel{background:#fff;padding:12px;border-radius:10px;border:1px solid rgba(15,23,42,0.04)}
    input[type="text"],input[type="number"]{width:100%;padding:9px;border-radius:8px;border:1px solid #e6edf2;font-size:14px;margin-top:8px}
    .controls{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap}
    button.btn{cursor:pointer;border:0;padding:9px 12px;border-radius:10px;font-weight:600}
    .btn-primary{background:var(--accent);color:white}
    .btn-danger{background:var(--danger);color:white}
    .btn-accent{background:transparent;border:1px solid var(--accent);color:var(--accent)}
    .transactions{max-height:280px;overflow:auto;margin-top:10px}
    .tx{display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:10px;border:1px solid rgba(15,23,42,0.04);margin-bottom:8px;background:#fff}
    .tx .left{max-width:68%}
    .tx .title{font-weight:600}
    .tx .meta{font-size:12px;color:var(--muted);margin-top:4px}
    .amt.plus{color:var(--success);font-weight:700}
    .amt.minus{color:var(--danger);font-weight:700}
    footer{font-size:12px;color:var(--muted);text-align:center;margin-top:12px}
    @media(max-width:700px){ .card-item{flex:0 0 220px} .grid{grid-template-columns:1fr} }
  </style>
</head>
<body>
  <div class="app" role="application" aria-label="MiniRevolut">
    <header>
      <div>
        <h1>MiniRevolut</h1>
        <div class="small">Portofel — RON</div>
      </div>
      <div style="text-align:right">
        <div class="small">Total general</div>
        <div id="totalAll" style="font-weight:700;color:var(--accent);font-size:20px">0,00 lei</div>
      </div>
    </header>

    <div class="nav" role="tablist" aria-label="Navigare">
      <button data-page="total" class="active">Total</button>
      <button data-page="card">Card</button>
      <button data-page="cash">Cash</button>
    </div>

    <main style="margin-top:12px">
      <section id="page-total">
        <div class="panel">
          <div style="display:flex;justify-content:space-between;align-items:flex-end">
            <div>
              <div class="small">Sold combinat</div>
              <div id="totalBig" style="font-size:22px;font-weight:700;color:var(--accent)">0,00 lei</div>
            </div>
            <div style="text-align:right">
              <div class="small">Cash</div>
              <div id="summaryCash" style="font-weight:700">0,00 lei</div>
            </div>
          </div>

          <div style="margin-top:12px" class="small">Carduri</div>
          <div class="card-row" id="cardsRow" aria-label="Lista carduri"></div>
        </div>

        <div style="margin-top:12px" class="panel">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div class="small">Acțiuni rapide</div>
            <div style="display:flex;gap:8px">
              <button id="openCardFromTotal" class="btn btn-accent">Deschide Card</button>
              <button id="openCashFromTotal" class="btn btn-accent">Deschide Cash</button>
            </div>
          </div>
        </div>
      </section>

      <section id="page-card" style="display:none">
        <div class="panel">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div class="small">Carduri</div>
            <div class="cards-controls">
              <input id="newCardTitle" placeholder="Nume card (ex: Principal)" style="padding:8px;border-radius:8px;border:1px solid #e6edf2" />
              <button id="addCardBtn" class="btn btn-primary">+ Adaugă card</button>
            </div>
          </div>
          <div style="margin-top:12px" id="cardsList" class="card-row"></div>
        </div>

        <div style="height:12px"></div>

        <div class="grid">
          <div class="panel">
            <div class="small">Cont activ: <strong id="activeCardTitle">N/A</strong> — sold: <span id="activeCardTotal">0,00 lei</span></div>
            <label>Sumă (lei)</label><input id="cardAmount" type="number" step="0.01" placeholder="ex: 600.00" />
            <label>Sursă</label><input id="cardSource" type="text" placeholder="card, salariu..." />
            <label>Notă (opțional)</label><input id="cardNote" type="text" placeholder="ex: Plata, retragere..." />
            <div class="controls" style="margin-top:8px">
              <button id="cardAdd" class="btn btn-primary">Adaugă (+)</button>
              <button id="cardRemove" class="btn btn-danger">Scoate (−)</button>
              <button id="cardRename" class="btn btn-accent">Redenumește</button>
            </div>
          </div>

          <div class="panel">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div class="small">Tranzacții Card</div>
              <div style="display:flex;gap:8px">
                <button id="cardExport" class="btn btn-accent">Export</button>
                <button id="cardClear" class="btn btn-danger">Șterge tot</button>
              </div>
            </div>
            <div class="transactions" id="cardList"></div>
          </div>
        </div>
      </section>

      <section id="page-cash" style="display:none">
        <div class="grid">
          <div class="panel">
            <div class="small">Cash — sold: <span id="cashTotal">0,00 lei</span></div>
            <label>Sumă (lei)</label><input id="cashAmount" type="number" step="0.01" placeholder="ex: 200.00" />
            <label>Sursă</label><input id="cashSource" type="text" placeholder="sticle, portofel..." />
            <label>Notă (opțional)</label><input id="cashNote" type="text" placeholder="ex: Bani din vânzare..." />
            <div class="controls" style="margin-top:8px">
              <button id="cashAdd" class="btn btn-primary">Adaugă (+)</button>
              <button id="cashRemove" class="btn btn-danger">Scoate (−)</button>
            </div>
          </div>

          <div class="panel">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div class="small">Tranzacții Cash</div>
              <div style="display:flex;gap:8px">
                <button id="cashExport" class="btn btn-accent">Export</button>
                <button id="cashClear" class="btn btn-danger">Șterge tot</button>
              </div>
            </div>
            <div class="transactions" id="cashList"></div>
          </div>
        </div>
      </section>
    </main>

    <footer><small>MiniRevolut demo — datele sunt salvate local pe dispozitiv.</small></footer>
  </div>

  <script>
(function(){
  const qs = s => document.querySelector(s);
  const qsa = s => Array.from(document.querySelectorAll(s));
  const format = v => (Number(v)||0).toLocaleString('ro-RO',{minimumFractionDigits:2,maximumFractionDigits:2}) + ' lei';
  const KEY = 'minirevolut_v5';

  const pages = { total: qs('#page-total'), card: qs('#page-card'), cash: qs('#page-cash') };
  const navButtons = qsa('.nav button');

  const totalAll = qs('#totalAll'); const totalBig = qs('#totalBig');
  const summaryCash = qs('#summaryCash'); const cardsRow = qs('#cardsRow');

  const cardsList = qs('#cardsList'); const newCardTitle = qs('#newCardTitle'); const addCardBtn = qs('#addCardBtn');
  const activeCardTitle = qs('#activeCardTitle'); const activeCardTotal = qs('#activeCardTotal');
  const cardAmount = qs('#cardAmount'); const cardSource = qs('#cardSource'); const cardNote = qs('#cardNote');
  const cardAdd = qs('#cardAdd'); const cardRemove = qs('#cardRemove'); const cardRename = qs('#cardRename');
  const cardList = qs('#cardList'); const cardExport = qs('#cardExport'); const cardClear = qs('#cardClear');

  const cashTotal = qs('#cashTotal'); const cashAmount = qs('#cashAmount'); const cashSource = qs('#cashSource'); const cashNote = qs('#cashNote');
  const cashAdd = qs('#cashAdd'); const cashRemove = qs('#cashRemove');
  const cashList = qs('#cashList'); const cashExport = qs('#cashExport'); const cashClear = qs('#cashClear');

  const openCardFromTotal = qs('#openCardFromTotal'); const openCashFromTotal = qs('#openCashFromTotal');

  let state = { cards: [], cash: {tx:[]}, page: 'total', activeCardId: null };

  function save(){ localStorage.setItem(KEY, JSON.stringify(state)); render(); }
  function load(){ try{ const v = localStorage.getItem(KEY); if(v) state = JSON.parse(v); }catch(e){} render(); }

  function sumTx(list){ return list.reduce((s,t)=>s+Number(t.amount||0),0); }
  function totalCards(){ return state.cards.reduce((s,c)=> s + sumTx(c.tx), 0); }
  function totalAllVal(){ return totalCards() + sumTx(state.cash.tx); }

  function render(){
    totalAll.textContent = format(totalAllVal()); totalBig.textContent = format(totalAllVal());
    summaryCash.textContent = format(sumTx(state.cash.tx)); cashTotal.textContent = format(sumTx(state.cash.tx));

    cardsRow.innerHTML = '';
    state.cards.forEach(c => {
      const item = document.createElement('div'); item.className='card-item';
      const preview = document.createElement('div'); preview.className='card-preview'; preview.style.background = c.color || 'linear-gradient(135deg, rgba(6,182,212,1), rgba(6,182,212,0.85))';
      const dot = document.createElement('div'); dot.className='card-dot';
      const title = document.createElement('div'); title.className='card-title'; title.textContent = c.title;
      preview.appendChild(dot); preview.appendChild(title);
      item.appendChild(preview);
      const foot = document.createElement('div'); foot.style.padding='8px'; foot.innerHTML = '<div style="display:flex;justify-content:space-between"><div style="font-weight:600">'+c.title+'</div><div>'+format(sumTx(c.tx))+'</div></div>';
      item.appendChild(foot);
      item.addEventListener('click', ()=> { state.activeCardId = c.id; state.page='card'; save(); });
      cardsRow.appendChild(item);
    });

    cardsList.innerHTML = '';
    state.cards.forEach(c => {
        const item = document.createElement('div'); item.className='card-item';
        const preview = document.createElement('div'); preview.className='card-preview'; preview.style.background = c.color || 'linear-gradient(135deg, rgba(6,182,212,1), rgba(6,182,212,0.85))';
        const dot = document.createElement('div'); dot.className='card-dot';
        const title = document.createElement('div'); title.className='card-title'; title.textContent = c.title;
        preview.appendChild(dot); preview.appendChild(title);
        item.appendChild(preview);
        const foot = document.createElement('div'); foot.style.padding='8px'; foot.innerHTML = '<div style="display:flex;justify-content:space-between"><div style="font-weight:600">'+c.title+'</div><div>'+format(sumTx(c.tx))+'</div></div>';
        const delBtn = document.createElement('button'); delBtn.className='btn btn-accent'; delBtn.textContent='Șterge'; delBtn.style.marginTop='6px';
        delBtn.addEventListener('click', (e)=>{ e.stopPropagation(); if(confirm('Ștergi acest card și toate tranzacțiile sale?')) { state.cards = state.cards.filter(x=>x.id!==c.id); if(state.activeCardId===c.id) state.activeCardId = state.cards.length ? state.cards[0].id : null; save(); } });
        foot.appendChild(delBtn);
        item.appendChild(foot);
        item.addEventListener('click', ()=> { state.activeCardId = c.id; save(); });
        cardsList.appendChild(item);
    });

    const active = state.cards.find(x=>x.id===state.activeCardId);
    activeCardTitle.textContent = active ? active.title : 'N/A'; activeCardTotal.textContent = active ? format(sumTx(active.tx)) : format(0);

    renderList(cardList, active ? active.tx : [], 'card', state.activeCardId);
    renderList(cashList, state.cash.tx, 'cash', null);

    Object.keys(pages).forEach(p => pages[p].style.display = (state.page === p) ? '' : 'none');
    qsa('.nav button').forEach(b => b.classList.toggle('active', b.dataset.page === state.page));
  }

  function renderList(container, list, type, id){
    container.innerHTML = '';
    if(!list || list.length===0){ container.innerHTML = '<div class="small">Nicio tranzacție.</div>'; return; }
    list.forEach(t=>{
      const div = document.createElement('div'); div.className='tx';
      const left = document.createElement('div'); left.className='left';
      const title = document.createElement('div'); title.className='title'; title.textContent = t.source + (t.note ? ' — ' + t.note : '');
      const meta = document.createElement('div'); meta.className='meta'; meta.textContent = t.date;
      left.appendChild(title); left.appendChild(meta);
      const right = document.createElement('div'); right.style.textAlign='right';
      const amt = document.createElement('div'); amt.className='amt ' + (Number(t.amount)>=0 ? 'plus' : 'minus'); amt.textContent = format(t.amount);
      const del = document.createElement('button'); del.className='btn btn-accent'; del.textContent='Șterge'; del.style.marginTop='6px';
      del.addEventListener('click', ()=>{ if(confirm('Ștergi această tranzacție?')) { if(type==='card') deleteTxCard(id, t.id); else deleteTxCash(t.id); } });
      right.appendChild(amt); right.appendChild(del);
      div.appendChild(left); div.appendChild(right); container.appendChild(div);
    });
  }

  function addCard(title){
    const t = title && title.trim() ? title.trim() : 'Card ' + (state.cards.length+1);
    const color = 'linear-gradient(135deg,' + (Math.random()>0.5 ? 'rgba(6,182,212,1)' : 'rgba(24,144,255,1)') + ', rgba(6,182,212,0.85))';
    const card = { id: 'c_' + Date.now().toString(36), title: t, tx: [], color };
    state.cards.push(card); state.activeCardId = card.id; save();
  }

  function addTxCard(amount, source, note){
    const active = state.cards.find(x=>x.id===state.activeCardId);
    if(!active){ alert('Alege mai întâi un card sau adaugă unul.'); return; }
    if(!amount || isNaN(amount)){ alert('Sumă invalidă'); return; }
    const tx = { id: Date.now() + Math.random().toString(36).slice(2,6), amount: Number(Number(amount).toFixed(2)), source: source||'(fără sursă)', note: note||'', date: new Date().toLocaleString() };
    active.tx.unshift(tx); save();
  }
  function deleteTxCard(cardId, txId){ const card = state.cards.find(x=>x.id===cardId); if(!card) return; card.tx = card.tx.filter(t=>t.id!==txId); save(); }
  function clearCard(cardId){ if(!confirm('Ștergi toate tranzacțiile acestui card?')) return; const card = state.cards.find(x=>x.id===cardId); if(!card) return; card.tx = []; save(); }

  function addTxCash(amount, source, note){ if(!amount || isNaN(amount)){ alert('Sumă invalidă'); return; } const tx = { id: Date.now() + Math.random().toString(36).slice(2,6), amount: Number(Number(amount).toFixed(2)), source: source||'(fără sursă)', note: note||'', date: new Date().toLocaleString() }; state.cash.tx.unshift(tx); save(); }
  function deleteTxCash(txId){ state.cash.tx = state.cash.tx.filter(t=>t.id!==txId); save(); }
  function clearCash(){ if(!confirm('Ștergi toate tranzacțiile Cash?')) return; state.cash.tx = []; save(); }

  function exportCSVList(list, name){ if(!list || list.length===0){ alert('Nu există tranzacții pentru export.'); return; } const rows = [['id','date','amount','source','note'], ...list.map(t=>[t.id,t.date,t.amount,t.source,t.note])]; const csv = rows.map(r=> r.map(c => '"' + String(c).replace(/"/g,'""') + '"').join(',')).join('\n'); const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'}); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = name + '-transactions-' + new Date().toISOString().slice(0,19).replace(/[:T]/g,'-') + '.csv'; a.click(); URL.revokeObjectURL(url); }

  qsa('.nav button').forEach(b=> b.addEventListener('click', ()=> { state.page = b.dataset.page; save(); }));
  openCardFromTotal.addEventListener('click', ()=> { if(state.cards.length) { state.page='card'; state.activeCardId = state.cards[0].id; save(); } else { alert('Adaugă mai întâi un card.'); } });
  openCashFromTotal.addEventListener('click', ()=> { state.page='cash'; save(); });

  addCardBtn.addEventListener('click', ()=> { addCard(newCardTitle.value); newCardTitle.value=''; });
  cardAdd.addEventListener('click', ()=> { addTxCard(Number(cardAmount.value), cardSource.value.trim(), cardNote.value.trim()); cardAmount.value=''; cardSource.value=''; cardNote.value=''; });
  cardRemove.addEventListener('click', ()=> { addTxCard(-Math.abs(Number(cardAmount.value)), cardSource.value.trim(), cardNote.value.trim()); cardAmount.value=''; cardSource.value=''; cardNote.value=''; });
  cardRename.addEventListener('click', ()=> { const active = state.cards.find(x=>x.id===state.activeCardId); if(!active){ alert('Selectează un card'); return; } const nn = prompt('Nume nou pentru card', active.title); if(nn) { active.title = nn.trim(); save(); } });
  cardClear.addEventListener('click', ()=> { if(state.activeCardId) clearCard(state.activeCardId); });
  cardExport.addEventListener('click', ()=> { const c = state.cards.find(x=>x.id===state.activeCardId); if(c) exportCSVList(c.tx, c.title); });

  cashAdd.addEventListener('click', ()=> { addTxCash(Number(cashAmount.value), cashSource.value.trim(), cashNote.value.trim()); cashAmount.value=''; cashSource.value=''; cashNote.value=''; });
  cashRemove.addEventListener('click', ()=> { addTxCash(-Math.abs(Number(cashAmount.value)), cashSource.value.trim(), cashNote.value.trim()); cashAmount.value=''; cashSource.value=''; cashNote.value=''; });
  cashClear.addEventListener('click', ()=> clearCash());
  cashExport.addEventListener('click', ()=> exportCSVList(state.cash.tx, 'cash'));

  if('serviceWorker' in navigator){ navigator.serviceWorker.register('service-worker.js').catch(()=>{}); }

  function ensureDefault(){ if(state.cards.length===0){ state.cards.push({ id:'c_default', title:'Card 1', tx:[], color:'linear-gradient(135deg, rgba(6,182,212,1), rgba(6,182,212,0.85))' }); state.activeCardId='c_default'; save(); } }
  load(); ensureDefault();
})();</script>
</body>
</html>